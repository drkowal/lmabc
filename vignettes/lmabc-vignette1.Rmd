---
title: "`lm_abc`: Linear Regression"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{lmabc-vignette1}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
## Vignette 1

The aim of this vignette is to demonstrate when and how to use lm_abc, and how to interpret results compared to normal lm linear regression models.  
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
First, load necessary libraries/packages:
```{r setup, message=FALSE}
library(lmabc)
library(MASS)
require(DataExplorer)
```


For this vignette, lets use the publicly available birthwt dataset.   
The birthwt dataset from the MASS package has data on 189 births at the Baystate Medical Centre, Springfield, Massachusetts during 1986 (Venables & Ripley, 2002). 
The dataframe contains these columns (taken directly from documentation):  

|Field|Description|
|---:|:---|
|low|indicator of birth weight less than 2.5kg|
|age|mother’s age in years|
|lwt|mother’s weight in pounds at last menstrual period|
|race|mother’s race (1 = white, 2 = black, 3 = other)|
|smoke|smoking status during pregnancy|
|ptl|number of previous premature labors|
|ht|history of hypertension|
|ui|presence of uterine irritability|
|ftv|number of physician visits during the first trimester|
|bwt|birth weight in grams|

First, look at dataset to understand its format and characteristics.
```{r}
head(birthwt)
```

From this we can see:     
Most variables are categorical (*race*, *smoke*, *ptl*, *ht*, *ui*, *ftv*, *low*).  
Only *age*, *lwt*, and *bwt* are continuous 

First, lets reformat our variables.   
1. Change *race* from numbers to the correct category label.  
2. Make *smoke*, *ptl*, *ht*, and *ui* T/F.  



```{r}
birthweight <- with(birthwt, {
	race <- factor(race, labels = c("white", "black", "other"))
	data.frame(age, lwt, race, smoke = factor(smoke > 0), ptl = factor(ptl > 0), 
						 ht = factor(ht > 0), ui = factor(ui > 0 ), ftv, bwt)
})

head(birthweight)
```

Now that we have our data formatted, let's investigate relationships between them. Let us assume for the sake of demonstration all assumptions for linear regression are met. 

Let's say we want to explore the relationships between the fields in the dataset and the variation birthweight (bwt). 

First, let's use lm package.   

## `lm` Model
```{r}
lm_fit <- lm(bwt ~ ., data = birthweight)
summary(lm_fit)
```
<p style="font-family: times, serif; font-size:10pt; font-style:italic">
A note on the low R^2^ score: 
"Some fields of study have an inherently greater amount of unexplainable variation. In these areas, your R^2^ values are bound to be lower. For example, studies that try to explain human behavior generally have R^2^ values less than $50%$. People are just harder to predict than things like physical processes." (source: https://statisticsbyjim.com/regression/interpret-r-squared-regression/)
</p>
\
&nbsp;


Notice the results of summary(lm_fit). There are only values for *smokeTRUE*, not *smokeFALSE* and likewise only *raceblack* and *raceother* but not *racewhite*. How can we decern what effect being white has on birth weight?  

Standard linear regression models chose one level for each categorical factor and make it the baseline. This necessary to not over-parameterize the model. More often than not when race is a covariate, Non-Hispanic White is the baseline. This can be problematic if an R user does not understand that all the factor-specific effects are *in comparison* to that group-specific baseline.   

Fortunately, lm_abc packages utilizes *abundance based constraints* to avoid this issue of overparameterization without the use of group-specific baselines.   
Unlike the lm package, lm_abc introduces a "universal" baseline, which takes into account the relative frequency of the different levels of each factor in the data and creates a neutral/proportionally average baseline to compare level specific effects to. Let's see this in action.

## `lm_abc` Model

**EXTREMELY IMPORTANT: You must center your predictors for lm_abc models!**  
**UPDATE: lm_abc centers continuous predictors for you now :)**
```{r}
lmabc_fit <- lmabc::lm_abc(bwt~., birthweight)
summary(lmabc_fit)
```

Notice the number of coefficient values for lm_abc compared to traditional lm! There are now coefficients for *racewhite*, *smokeFALSE*, *ptlFALSE*, and all the levels that previously had been absorbed into the baseline of lm. The effects of any level of a given factor can now be reported and interpreted relative to the general baseline instead of a group baseline.    

## Relationship between `lm` and `lm_abc`

It is important to understand the relationship between lm and lm_abc. Under the hood, these are both fitting/estimating the same model, and this can be seen a number of ways.   

Look at the *raceother* coefficient value from lm: $-340.268$. This is the relative effect being raceother has on the regression *in comparison to* being *racewhite* with all other predictors held constant.   

We can get the same conclusion from lm_abc but with more detail. The coefficient value of *raceother* is $-154.438$, and the value for *racewhite* is $185.831$. Therefore, the effect of being *raceother* *in comparison to* being *racewhite* with all other predictors held constant is $-154.438 - 185.831 = -340.268$, the same value we get from lm. We can see from this small demonstration that lm and lm_abc do fit the same model given the data, but lm_abc gives categorical coefficient values for each factor level in comparison to a neutral baseline. This elimination of group-specific baselines leads to more interpretable and equitable inferences.

For testing the validity of the model, you can employ the same tools as you would for lm. The residuals of lm vs lm_abc models are the same.   
 



Check: these plots are the same: 

```{r}
plot(lm_fit)
```

```{r}
plot(lmabc_fit)
```

\
&nbsp; 

## Conclusion 
It is our intention to have lm_abc become the standard package used when creating a regression model with categorical covariates. The inclusion of the population baseline provides more equitable interpretations. Instead of reporting a race-specific effect in comparison to the Non-Hispanic White group, a race effect (with all other predictors held constant) can be reported compared to the population baseline, truly isolating the race-specific effect. We hope as well that it will reduce incorrect interpretations of lm outputs.      

Looking towards the future, this methodology will be available of glm, as well as penalized estimation (like lasso).    

### End of Vignette    

This research is by Dr. Daniel Kowal of the Rice University Statistics Department.

\
&nbsp; 
Question: 
```{r, results='hide'}
lmabc_fit2 <- lmabc::lm_abc(bwt~ age + lwt + race + smoke + ht + ui + age*smoke, birthweight)
summary(lmabc_fit2)
#include its use with interactions or is that unnecessary? it is the same as lm
```

  


   
